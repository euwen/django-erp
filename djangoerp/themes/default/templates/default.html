{% extends "base.html" %}

{% load i18n %}
{% load staticfiles %}
{% load breadcrumbs %}
{% load avatar %}
{% load menus %}
{% load regions %}

{% block extrastyle %}
    <link rel="stylesheet" href="{% static 'css/default.css' %}"/>
{% endblock %}

{% block wrapper %}
    <div id="header" class="ui top fixed inverted menu">
        <div class="brand header item">
            {% include "partials/brand.html" %}
        </div>
        <div class="ui top left pointing dropdown icon item">
            <i class="search icon"></i>
            <div class="ui vertical menu">
                <div class="ui icon search input">
                    <i class="search icon"></i>
                    <input type="text" placeholder="{% trans 'Search...' %}">
                </div>
                <div class="icon item">
                    <i class="tags icon"></i>
                    {% trans "Tags" %}
                    <span class="description">{% blocktrans with count=0 %}{{ count }} item/s{% endblocktrans %}</span>
                </div>
                <div class="icon item">
                    <i class="asterisk icon"></i>
                    {% trans "Categories" %}
                    <span class="description">{% blocktrans with count=0 %}{{ count }} item/s{% endblocktrans %}</span>
                </div>
            </div>
        </div>
        <div class="date item">
            <div class="content">
                <i class="tiny calendar icon"></i>
                <span class="label">{% now "SHORT_DATE_FORMAT" %}</span>
            </div>
        </div>
        <div class="nav icon link item">
            <i class="chevron left icon"></i>
        </div>
        <div class="sidebar icon link item">
            <i class="bars icon"></i>
        </div>
    </div>

    <div id="sidebar" class="ui inverted segment">
        {% block sidebar %}
        {% render_region "sidebar" "pluggets/partials/region.html" %}
        {% endblock %}
    </div>

    <div class="pusher">
        <div id="userarea" class="ui inverted menu">
            <a class="ui home icon item" href="{% url 'home' %}" title="{% trans 'Home' %}">
                <i class="home icon"></i>
            </a>
            <div class="ui breadcrumb item">
                {% block breadcrumbs %}{% endblock %}{% render_breadcrumbs %}
            </div>
            <div class="ui bookmarks top left pointing dropdown icon item">
                <i class="empty star icon"></i>
                {% render_user_bookmarks %}
            </div>
            <div class="ui notifications top center pointing dropdown icon item">
                <i class="inbox icon"></i>
                {% with user.notification_set.unread.count as notification_count %}
                {% if notification_count %}<div class="floating ui red label">{{ notification_count }}</div>{% endif %}
                <div class="menu">
                    <div class="header">
                        {% trans "Notifications" %}
                    </div>
                    <div class="divider"></div>
                    {% if notification_count %}
                    {% for notification in user.notification_set.unread.all %}
                    <div class="item">
                        <i class="mail icon"></i>
                        <a class="ui" href="{{ notification.get_absolute_url }}">{{ notification }}</a>
                        <div class="description">{{ notification.created|timesince }}</div>
                    </div>
                    {% endfor %}
                    <div class="divider"></div>
                    {% endif %}
                    <a class="ui item" title="{% trans 'View all' %}" href="{% url 'notification_list' 'users' user.pk %}">
                        <i class="list icon"></i>
                        {% trans "View all" %}
                    </a>
                </div>
                {% endwith %}
            </div>
            <a class="ui profile item" href="{{ user.get_absolute_url }}">
                {% avatar user.email "32" css_class="ui avatar image" %} {{ user }}
            </a>
            <a class="ui logout icon item" href="{% url 'user_confirm_logout' %}">
                <i class="large power off icon"></i>
            </a>
        </div>

        <div id="main" class="ui raised segment">
            {% block layout %}
            {% endblock %}
        </div>
        
        {% include "partials/footer.html" %}
    </div>
{% endblock %}

{% block onbodyload-semanticui %}
    $('.ui.dropdown')
        .dropdown({
            transition: 'fade',
        });

    $('.details.accordion')
        .accordion({
            exclusive: false
        });

    $('.ui.message .close')
        .on('click', function() {
            $(this)
                .closest('.message')
                .transition('fade');
        });

    $('#sidebar .ui.sticky')
        .sticky({ context: '.pusher' });
{% endblock %}

{% block onbodyload-djangoerp %}
    $('#header .brand.item > a')
        .transition('tada')
        .hover(

            // Hover in.
            function(e) {

                if (!$(this).hasClass("visible")) {

                    $(this).transition('tada');
                }
            },

            // Hover out.
            function(e) {

                $(this).transition('clear queue');
            }
        );

    $('#header .sidebar.item')
        .on('click', function(e) {
            $(this)
                .toggleClass('active');
            $('#sidebar')
                .toggleClass('visible');
        });

    $('#header .nav.item')
        .on('click', function(e) {
            $(this)
                .toggleClass('active');
            $('#header')
                .toggleClass('collapsed');
        });

    $('#messages .message')
        .transition('fly left in');

    $('.logout.item').on('click', function(e) {

        e.preventDefault();

        var self = $(this);
        var action = self.attr('href');

        $.ajaxRequest(action, "GET", {}, null, function(content) {

            self.after(content).siblings('.modal').modal('show');
        });
    });

    $('.delete.button').on('click', function(e) {

        e.preventDefault();

        var self = $(this);
        var action = self.attr('href');

        $.ajaxRequest(action, "GET", {}, null, function(content) {

            self.after(content).siblings('.modal').modal('show');
        });       
    });
{% endblock %}
